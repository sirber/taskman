{% extends 'layout.html' %}

{% block bodytitle %}Tâche #{{datas[0].id}}{% endblock %}

{% block body %}
<div class="row">
	<div class="col-xs-12 col-sm-12 col-md-6 col-lg-6">
		<div class="form-group">
			<label for="name">Nom:</label>
			<input type="text" class="form-control" name="fields[name]" value="{{datas[0].name}}" />
		</div>
		<div class="form-group">
			<label for="name">Catégorie</label>
			<select class="form-control" name="fields[category_id]">
                <option></option>
                {% for category in ref_category %}
                <option value="{{category.id}}" {% if datas[0].category_id == category.id %}selected{%endif%}>{{category.name_fr}}</option>
                {% endfor %}
            </select>
		</div>
		<div class="form-group">
			<label for="name">Date de début:</label>
			<input type="text" class="form-control" name="fields[date_start]" value="{{datas[0].date_start}}" />
		</div>
		<div class="form-group">
			<label for="name">Date de fin:</label>
			<input type="text" class="form-control" name="fields[date_end]" value="{{datas[0].date_end}}" />
		</div>	
        <div class="form-group">
			<label for="name">Rémunération (type)</label>
            <select class="form-control" name="fields[remuneration_type]">
				<option></option>
				<option value="1" {% if datas[0].remuneration_type == 1 %}selected{%endif%}>Taux horraire</option>
				<option value="2" {% if datas[0].remuneration_type == 2 %}selected{%endif%}>Taux fixe</option>
			</select>
		</div>        
	</div>
	
	<div class="col-xs-12 col-sm-12 col-md-6 col-lg-6">
		<div class="form-group">
			<label for="name">Client:</label>
            <select class="form-control" name="fields[client_id]">
                <option></option>
                {% for user in ref_user %}
                <option value="{{user.id}}" {% if datas[0].client_id == user.id %}selected{%endif%}>{{user.id}} - {{user.name}}</option>
                {% endfor %}
            </select>
		</div>
		<div class="form-group">
			<label for="name">Priorité</label>
			<select class="form-control" name="fields[priority]">
				<option></option>
				<option value="1" {% if datas[0].priority == 1 %}selected{%endif%}>Bas</option>
				<option value="2" {% if datas[0].priority == 2 %}selected{%endif%}>Moyen</option>
				<option value="3" {% if datas[0].priority == 3 %}selected{%endif%}>Haut</option>
			</select>
		</div>
		<div class="form-group">
			<label for="name">Difficulté</label>
			<select class="form-control" name="fields[difficulty]">
				<option></option>
				<option value="1" {% if datas[0].difficulty == 1 %}selected{%endif%}>Facile</option>
				<option value="2" {% if datas[0].difficulty == 2 %}selected{%endif%}>Moyen</option>
				<option value="3" {% if datas[0].difficulty == 3 %}selected{%endif%}>Difficile</option>
			</select>
		</div>
		<div class="form-group">
			<label for="name">Heures estimés:</label>
			<input type="text" class="form-control" name="fields[nb_hour_estimated]" value="{{datas[0].nb_hour_estimated}}" />
		</div>
        <div class="form-group">
			<label for="name">Rémunération ($/h ou $)</label>
			<input type="text" class="form-control" name="fields[remuneration_value]" value="{{datas[0].remuneration_value}}" />
		</div>
	</div>
</div>

<div class="row">
	<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
		<button class="btn btn-danger btn-lg" type="submit">Enregistrer</button>&nbsp;
		<a class="btn btn-warning btn-lg" href="{{ base_url() }}/task/list">Retour</a>&nbsp;
		<button class="btn btn-default btn-lg" type="button">Imprimer</button>&nbsp;
		<button class="btn btn-default btn-lg" type="button">Facture</button>&nbsp;		
	</div>
</div>
{% endblock %}

{% block body_extra %}
{# Notes #}
<div class="row">
	<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
		<div class="panel panel-default">
			<div class="panel-heading">
				<h3 class="panel-title">Notes</h3>
			</div>
			<textarea style="width: 100%" rows="12" name="fields[notes]">{{datas[0].notes|striptags}}</textarea>
		</div>            
	</div>
</div>

{# Étapes de planification #}	
<div class="row">
	<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
		<div class="panel panel-default">
			<div class="panel-heading">
				<h3 class="panel-title">Étapes de planification</h3>
			</div>
			<div class="panel-body">
				<table class="table" id="task_marker">
                    <thead>
                        <tr>
                            <th>Numéro</th>
                            <th>Nom</th>
                            <th>Commentaire</th>
                            <th>Heures</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
                    
                    </tbody>
                    <tfoot>
                        <tr>
                            <td><input type="text" name="position" class="form-control"></td>
                            <td><input type="text" name="name" class="form-control"></td>
                            <td><input type="text" name="comment" class="form-control"></td>
                            <td><input type="text" name="nb_hour_estimated" class="form-control"></td>
                            <td style="vertical-align: middle;">
                                <span class="glyphicon glyphicon-plus-sign" id="task_planif_add"></span>&nbsp;
                                <span class="glyphicon glyphicon-remove-circle" id="task_planif_add_clear"></span>                                
                            </td>
                        </tr>
                    </tfoot>
                </table>
			</div>
		</div>
	</div>
</div>

{# Heures travaillés #}	
<div class="row">
	<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
		<div class="panel panel-default">
			<div class="panel-heading">
				<h3 class="panel-title">Heures travaillés</h3>
			</div>
			<div class="panel-body">
                <table class="table" id="task_work">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Commentaire</th>
                            <th>Heures</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
                    
                    </tbody>
                    <tfoot>
                        <tr>
                            <td><input type="text" class="form-control"></td>
                            <td><input type="text" class="form-control"></td>
                            <td><input type="text" class="form-control"></td>
                            <td style="vertical-align: middle;">
                                <span class="glyphicon glyphicon-plus-sign" id="task_worked_hours_add"></span>&nbsp;
                                <span class="glyphicon glyphicon-remove-circle" id="task_worked_hours_add_clear"></span>                                
                            </td>
                        </tr>
                    </tfoot>
                </table>				
			</div>
		</div>
	</div>
</div>

{# Facturation #}
<div class="row">
	<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
		<div class="panel panel-default">
			<div class="panel-heading">
				<h3 class="panel-title">Facturation</h3>
			</div>
			<div class="panel-body">
				<table class="table" id="task_billing">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Commentaire</th>
                            <th>Montant</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
                    
                    </tbody>
                    <tfoot>
                        <tr>
                            <td><input type="text" class="form-control"></td>
                            <td><input type="text" class="form-control"></td>
                            <td><input type="text" class="form-control"></td>
                            <td style="vertical-align: middle;">
                                <span class="glyphicon glyphicon-plus-sign" id="task_worked_hours_add"></span>&nbsp;
                                <span class="glyphicon glyphicon-remove-circle" id="task_worked_hours_add_clear"></span>                                
                            </td>
                        </tr>
                    </tfoot>
                </table>			
			</div>
		</div>
	</div>
</div>

{% endblock %}

{% block javascripts %}
$(document).ready(function() {
    $("#task_planif_add, #task_worked_hours_add").on("click", addNew).css('cursor', 'pointer');
});

var iRow = 0;
function addNew(e) {
    var id = $(this).parents('table').attr('id');
    var row = $(this).parents("tr").clone();    
    $(row).find("td:last span:first").remove(); 
    $(row).find("input").each(function() {
        $(this).attr("name", id + "[" + iRow + "][" + $(this).attr("name") + "]");
    });
    iRow = iRow + 1;
    
    $(this).parents("table").find("tbody").append(row);
    $(this).parents("tr").find('input').val('');
}
{% endblock %}
